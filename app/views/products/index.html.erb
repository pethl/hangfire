<h1>HF Products</h1>
<%= link_to '+ add new product', new_product_path %>
<br>
<% @products_by_category.each do |category_id, products| %>
 <h3><%= Category.where(:id => category_id).first.name %> </h3>
<table class="table">
<thead>
  <tr>
    <th colspan="1"></th>
    <th>Ingredient #</th>
    <th>Ingredient Cost (p)</th>
    <th>linked Products #</th>
    <th>linked product Cost (p)</th>
    <th>Total Cost (p)</th>    
    <th colspan="3"></th>
  </tr>
</thead>
  
  <tbody>
  <% products = products.sort_by { |h| h[:name]} %>
    <% products.each do |product| %>
    
      <tr>  
        <td><strong><%= link_to product.name, product  %></strong></td>
        <td><%= product.productitems.count %></td>
        <td><%= number_with_precision(Product.get_total_price(product.id), :precision =>2) %></td>        
        <td><%= count = Friendship.where(:product_id => product.id).count %></td>
        <% if count > 0 %>
<%        friend_id = Friendship.where(:product_id => product.id).first.friend_id %>
        <% vol = Friendship.where(:product_id => product.id).first.prodvolume %>
        <td><%= number_with_precision(Product.get_ratios_price(friend_id,vol), :precision =>3) %></td>       
        <% else %> 
        <td></td>
        <% end %> 
        <td>Total cost calc here</td>
        <td>[<%= link_to 'Show', product %> | 
        <%= link_to 'Edit', edit_product_path(product) %> | 
        <%= link_to 'Destroy', product, method: :delete, data: { confirm: 'Are you sure?' } %>]</td>
      </tr> 
      <% end %>
      </tbody>
         
</table>
 <% end %>

<button class="btn">	<a>Import productitems</a><%= form_tag import_productitems_path, multipart: true do %>
	                      <%= file_field_tag :file %>
	                      <%= submit_tag "Import" %>
                        <% end %>
  </button>
<br><br>
